(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=function(e,t,o){let r=`${e}=${t}; path=/`;if(o){const e=new Date;e.setTime(e.getTime()+60*o*60*1e3),r+=`; expires=${e.toUTCString()}`}document.cookie=r},o=(e,o)=>{let r=e.getAttribute("id");r=r.replace("popup-builder-","");const{entrAnimation:n,exitAnimation:s,animationDuration:c,type:i}=o||{},p=e.querySelector(".popup-builder-container");p.classList.remove(`${n}`),p.classList.add(`${s}`),p.classList.add("reverse"),setTimeout(()=>{["popup","full-screen"].includes(i)&&o?.preventScroll&&(window.parent.document.body.style.overflow=""),e.classList.remove("popup-builder-modal--open"),p.classList.remove(`${s}`),p.classList.remove("reverse"),t(`pbb_closed_${r}`,"true",8760),window.frameElement&&window.frameElement.remove()},1e3*c)},r=function(e){const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?t.pop().split(";").shift():null},n=window.wp.apiFetch;var s=e.n(n);const c=async(e,o)=>{if(e&&!r(`pbb_conversion_${o}`)&&location.search.includes("iframe=true")){const e=Number(sessionStorage.getItem("pbb_logs"));await s()({path:"/pbb/v1/popup/logs",method:"PUT",data:{id:e,converted:!0,refferer:window.parent.document.referrer}}).then(e=>{"success"===e.status?t(`pbb_conversion_${o}`,"true",8760):console.error("Error updating conversion count:",e.message)})}},i=e=>{const t=JSON.parse(e.getAttribute("data-settings"));return{popupID:e.getAttribute("id").replace("popup-builder-",""),popupAttributes:t}},p=/^(mailto:)?[a-z0-9._%+-]+@[a-z0-9][a-z0-9.-]*\.[a-z]{2,63}$/i;function a(e){return p.test(e)}const l=/^(tel:)?(\+)?\d{6,15}$/;function u(e){return e=e.replace(/[-.() ]/g,""),l.test(e)}const d=window.wp.hooks,m=(e,t)=>{const o=document.querySelector(e);if(!o)return;const r=document.createElement("div");r.innerHTML=t.trim(),o.innerHTML="",Array.from(r.childNodes).forEach(e=>{o.appendChild(e)});const n=document.querySelector(".popup-builder-coupon-code-wrapper");n?.addEventListener("click",()=>{const e=n.querySelector(".popup-builder-coupon-code-text"),t=e.textContent;(async e=>{try{await navigator.clipboard.writeText(e)}catch{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(e){console.error("Copy failed",e)}document.body.removeChild(t)}})(t).then(()=>{e.textContent="COPIED!",setTimeout(()=>e.textContent=t,3e3)})})},b=e=>e.closest(".pbb-form__field").querySelector(".error-message"),f=(e,t,o="client-error")=>{const r=document.createElement("div");r.classList.add("error-message"),r.textContent=t,r.id=o,e.parentElement.insertAdjacentElement("afterend",r)},y=(e,t,o)=>{const r=t(e.value),n=b(e);r?n&&n.remove():(n||f(e,`Please enter a valid ${o}`),e.focus())};var w;w="form",window.addEventListener("load",()=>{window[`__POPUPKIT_${w.toUpperCase()}_INIT`]||(window[`__POPUPKIT_${w.toUpperCase()}_INIT`]=!0,(()=>{const e=document.querySelectorAll(".pbb-form");if(!e.length)return;const t=document.querySelector('[data-block="popup-builder-block/coupon-wheel"]'),n=document.querySelector('[data-block="popup-builder-block/step"]');for(const p of e){const e=p.querySelector('input[type="email"]'),l=p.querySelector('input[type="tel"]'),w=p.querySelector(".pbb-form__submit-btn"),v=JSON.parse(p.getAttribute("data-settings")),{action:h,redirectURL:S,email:g,phone:_,copyText:C,newWindowURL:q,closeCampaign:k,istrackConversion:$,integration:x,message:T,closeCampaignDelay:L=3,step:A}=v||{},E=p.closest(".popup-builder-modal"),{popupID:I,popupAttributes:P}=i(E),N=Array.from(p.querySelectorAll("[required]"));p.addEventListener("submit",async i=>{i.preventDefault();for(const e of N){const t=b(e);if(e.value)t&&t.remove();else{if(t)continue;f(e,"This field is required"),e.focus()}}e&&y(e,a,"email"),l&&y(l,u,"phone number");const O=p.querySelector(".error-message");if(O&&"server-error"!==O.id)return;O&&"server-error"===O.id&&O.remove();const D=document.createElement("span");D.classList.add("pbb-form-loader"),w.append(D),w.querySelector(".btn-text").style.opacity=0;const U=new FormData(p,w),z={popup_id:I,form_data:{},user_data:r("pbb_user_info")||{}};for(const[e,t]of U)"email"!==e&&"name"!==e?z.form_data[e]=t.trim():z[e]=t.trim();let F=!1;if(x){const e=["mailchimp","fluentCRM","activeCampaign","zapier","hubspot","pabbly","aweber","zoho","convertKit","webhook","mailpoet","mailerlite","klaviyo","getResponse","brevo","omnisend","drip"];for(const t of e)x?.[t]&&(z[t]=x[t],F=!0)}if(F&&(z.third_party_integration=!0),"true"===sessionStorage.getItem(`pbb_submitted_${I}`))return w.querySelector(".pbb-form-loader").remove(),w.querySelector(".btn-text").style.opacity=1,p.querySelector(".pbb-form-success")?.remove(),void f(w,"You have already submitted this form.");let H=null;t&&((0,d.doAction)("popup.triggerSpinWheel",!0),H=await new Promise(e=>{(0,d.addAction)("popup.wheelSpinCompleted","pbb/spinCompleteHandler",t=>{e(t),(0,d.removeAction)("popup.wheelSpinCompleted","pbb/spinCompleteHandler")})}));const M=(0,d.applyFilters)("popup.wheelCouponCode",null,!0);H&&!n&&m(".wp-block-popup-builder-block-form",`\n\t\t\t\t\t<div class="popup-builder-coupon-wheel-result">\n      \t\t\t\t\t<h1 class="popup-builder-coupon-wheel-title">${M?.success?.wheelSuccessMessage}</h1>\n      \t\t\t\t\t<p class="popup-builder-coupon-wheel-description">${M?.success?.wheelSuccessDescription}</p>\n      \t\t\t\t\t<div class="popup-builder-coupon-code-wrapper">\n      \t\t\t\t\t\t<span class="popup-builder-coupon-code-label">${M?.success?.wheelCouponCodeLabel}</span>\n        \t\t\t\t\t<span class="popup-builder-coupon-code-text">${M?.couponCode}</span>\n      \t\t\t\t\t</div>\n    \t\t\t\t</div>\n \t\t \t\t\t`);const R=async e=>{w.querySelector(".pbb-form-loader").remove(),w.querySelector(".btn-text").style.opacity=1;const t=window.getComputedStyle(w).getPropertyValue("position"),r=document.createElement("div");r.className="pbb-form-success",r.textContent=T,"absolute"===t?p.querySelector(".pbb-form__field-0").append(r):w.parentElement.append(r),p.reset(),w.disabled=!0,e&&(sessionStorage.setItem(`pbb_submitted_${I}`,"true"),await c($,I)),k&&setTimeout(()=>{o(E,P)},1e3*L),(()=>{switch(h){case"redirect-url":window.location.href=S;break;case"email":window.location.href=`mailto:${g}`;break;case"call":window.location.href=`tel:${_}`;break;case"copy-text":navigator.clipboard.writeText(C);break;case"new-window":window.open(q,"_blank");break;case"step":const e=(0,d.applyFilters)("popupkit.steps.form",""),t=document.querySelectorAll(".wp-block-popup-builder-block-step");for(const e of t)e.classList.contains("active")&&e.classList.remove("active");const o=e[parseInt(A)];if(o.classList.add("active"),n&&n){const e=document.createTreeWalker(o,NodeFilter.SHOW_TEXT,null,!1);for(;e.nextNode();){const t=e.currentNode;t.nodeValue.includes("{{coupon_code}}")&&(t.nodeValue=t.nodeValue.replace("{{coupon_code}}",M?.couponCode))}}document.querySelector(".popupkit-steps-inner").insertBefore(o,t[parseInt(v.step)])}})()};location.search.includes("iframe=true")?s()({path:"/pbb/v1/subscribers",method:"POST",body:JSON.stringify(z)}).then(e=>{"error"===e.status?(w.querySelector(".pbb-form-loader").remove(),w.querySelector(".btn-text").style.opacity=1,p.querySelector(".pbb-form-success")?.remove(),f(w,e.message,"server-error")):R(!0)}):R(!1)})}})())})})();